# Q) 18. Activity 또는 Fragment 간에 데이터를 어떻게 전달하나요?

### Activity 간 데이터 전달
가장 일반적인 방식은 Intent 입니다. 데이터는 키-값 형태로 `putExtra()` 를 호출해
내부적으로 Bundle 을 생성해 전달합니다.
```kotlin
// 데이터를 전달하는 Activity
val intent = Intent(this, SecondActivity::class.java).apply {
    putExtra("USER_NAME", "John Doe")
    putExtra("USER_AGE", 25)
}
startActivity(intent)

// 데이터를 수신하는 Activity
class SecondActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_second)

        val userName = intent.getStringExtra("USER_NAME")
        val userAge = intent.getIntExtra("USER_AGE", 0)
        Log.d("SecondActivity","User Name: $userName, Age: $userAge")
    }
}
```

### Fragment 간 데이터 전달
Fragment 간 데이터 전달에도 Bundle 을 사용합니다.
arguments 를 통해 수신하는 Fragment 로 전달합니다.
```kotlin
// 데이터를 전달하는 Fragment
val fragment = SecondFragment().apply {
    arguments = Bundle().apply {
        putString("USER_NAME", "John Doe")
        putInt("USER_AGE", 25)
    }
}
parentFragmentManager.beginTransaction()
    .replace(R.id.fragment_container, fragment)
    .commit()

// 데이터를 수신하는 Fragment
class SecondFragment : Fragment() {
    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? { 
        val view = inflater.inflate(R.layout.fragment_second, container, false)

        val userName = arguments?.getString("USER_NAME") 
        val userAge = arguments?.getInt("USER_AGE")
        Log.d("SecondFragment", "User Name: $userName, Age: $userAge")
        
        return view 
    }
}
```

### Jetpack Navigation 라이브러리로 Fragment 간 데이터 전달
Jetpack Navigation 라이브러리에서 지원하는 Safe Args 플러그인을 사용하여,
type-safe 내비게이션과 인수전달을 가능하게 하는 direction 및 argument 클래스가 컴파일
타임에 자동으로 생성됩니다. 이를 통해, 런타임 시 값을 안전하게 가져올 수 있습니다.
1. 내비게이션 그래프에서 인수(argument) 정의하기
nav_graph.xml 에서 argument 를 지정합니다.
```xml
<fragment 
    android:id="@+id/secondFragment" 
    android:name="com.example.SecondFragment">
    <argument 
        android:name="username" 
        app:argType="string" />
</fragment>
```
2. 소스 프래그먼트에서 데이터 전달하기
대상 객체와 빌드 클래스를 생성해 명시적으로 데이터를 전달가능하게 합니다.
```kotlin
val action = FirstFragmentDirections
    .actionFirstFragmentToSecondFragment(username = "kong")
findNavController().navigate(action)
```
3. 대상 프래그먼트에서 데이터 검색하기
```kotlin
val username = arguments?.let { 
    SecondFragmentArgs.fromBundle(it).username
}
```
Safe Args 를 사용해 정의된 값을 안전하게 가져올 수 있습니다.

### 동일 Activity 내에서 Shared ViewModel 사용
동일한 Activity 내에서 Fragment 간 통신시에는 Shared ViewModel 을 사용할 수 있습니다.
`androidx.fragment:fragment-ktx` 패키지에서 제공하는 `activityViewModels()` 메서드를 사용해
구현 가능합니다. Fragment 가 동일한 ViewModel 범위를 Activity 로 지정하여 공유하게 합니다.
```kotlin
// Shared ViewModel
class SharedViewModel: ViewModel() {

    private val _userData = MutableStateFlow<User?>(null)
    val userData : StateFlow<User?>
    
    fun setUserData(user: User) { 
        _userData.value = user
    }
}

// Fragment A (데이터를 전송하는 Fragment)
class FirstFragment : Fragment() {
    private val sharedViewModel: SharedViewModel by activityViewModels()
    
    fun updateUser(user: User) { 
        sharedViewModel.setUserData(user) // 데이터 저장
    }
}

// Fragment B (데이터를 수신하는 Fragment)
class SecondFragment : Fragment() { 
    private val sharedViewModel: SharedViewModel by activityViewModels()
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) { 
        lifecycleScope.launch { 
            viewLifecycleOwner.repeatOnLifecycle(Lifecycle.State.RESUMED) { 
                sharedViewModel.userData.collectLatest { user ‑>
                    // TODO: user data 처리.. 
                } 
            } 
        } 
    }
}

// Activity (Activity 에서 데이터 수신하기)
class MainActivity : ComponentActivity() { 
    private val sharedViewModel: SharedViewModel by viewModels()
    
    override fun onCreate(savedInstanceState: Bundle?) { 
        lifecycleScope.launch { 
            lifecycle.repeatOnLifecycle(Lifecycle.State.RESUMED) { 
                sharedViewModel.userData.collectLatest { user ‑>
                    // TODO: user data 처리.. 
                } 
            } 
        } 
    }
}
```

<br/>

<details>

<summary>Fragment Result API 를 이용한 방식</summary>

직접 참조 없이 Fragment 간에 일회성으로 값을 전달할 수 있는 메커니즘을 제공합니다.

FragmentManager를 활용하여 결과를 수신하는 Fragment가 활성화될 때까지 결과 값이 안전하게
보존되므로, Fragment 간에 의존성을 분리하고 생명주기를 인지하여 동작하는 통신 메커니즘을 보장합니다.

해당 접근 방식은 QR 코드 스캔, 사용자 입력 다이얼로그 또는 양식 제출과 같은 다양한 시나리오에서
(A‑>B‑>A 형태의 화면 이동) 유용하며, Fragment 기반 내비게이션을 더 효율적으로 만들어줍니다.
</details>

### 실전 질문
Q) 동일한 Activity 내에서 Fragment 간 데이터를 주고받을 때 어떤 방법이
효과적인지 설명해 주시고, ViewModel을 활용한다면 Bundle 이나
직접적인 Fragment 트랜잭션을 사용하는 것과 비교했을 때 어떤 이점이 있나요?


만약 Fragment 간에 데이터를 전달해야할 것이 많다면 SharedViewModel 을 사용하고,
아닌 경우에는 Jetpack Navigation 의 Safe-Args 를 사용해 데이터를 전달합니다.

Safe-args 방식은 런타임 오류를 줄이고, Share ViewModel 방식은 생명주기에
안전하게 데이터를 수신 할 수 있습니다.
