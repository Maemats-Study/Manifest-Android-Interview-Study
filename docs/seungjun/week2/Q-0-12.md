# Q) 12. 구성 변경(configuration changes)을 어떻게 처리하나요?

안드로이드에서 구성 변경 예:
- 화면 회전
- 언어 변경
- 다크/라이트 모드 전환
- 글꼴 크기 및 두께 조정
- 하드웨어 키보드 연결 또는 해제
- 멀티 윈도우 모드 시작

구성 변경시 Activity 를 새로 다시 만들기 때문에 이에 대한
상태를 보존해주는 것이 중요합니다.

### 구성 변경시 대응
1. UI 상태 저장 및 복원<br/>
저장된 인스턴스 상태를 사용하는 방법으로 `onSaveInstanceState()` 및
`onRestoreInstanceState()` 메서드를 구현하여 Activity 재생성 중
UI 상태를 일시적으로 유지하여 복원합니다.
2. Jetpack ViewModel<br/>
ViewModel 클래스를 활용해 메모리에서 UI 관련 상태를 처리합니다.
3. 구성 변경을 수동으로 처리하는 방법
`AndroidManifest.xml` 에서 구성 변경 사항을 `android:configChanges` 속성을 사용해
피할 수 있습니다. `onConfigurationChanged()` 메서드를 재정의 하여 해당 변경 사항이 발생했을 때
수동으로 관리합니다.
4. Jetpack Compose 에서 `rememberSaveable` 활용
`rememberSaveable` 을 활용하여 구성 변경 발생시 UI 상태를 보존 할 수 있습니다.
`onSaveInstanceState()` 와 유사하게 동작하지만 Compose 에서 Composable 상태를 일관되게 유지하는 데
도움됩니다.

### 정리
Activity 재생성을 `android:configChanges` 방지하는 경우, 구성 변경에 따른
리소스 재할당을 직접 관리해야합니다.<br/>추가로, Android 11L(API 수준 30)~Android 13(API 수준 33)에서는
`onConfigurationChanged()` 호출 되지 않는 문제가 있기에 대부분의 상황에서
Activity 재생성을 유도하고 ViewModel 에서 관리하는 것이 좋아보입니다.

### 실전 질문
Q) 구성 변경(Configuration Change)을 처리하기 위한 전략에는 무엇이 있으며,
ViewModel은 구성 변경으로부터 손실될 수 있는 UI 관련 데이터를 어떻게 보존하나요?<br/>
- `savedInstance` 를 사용하는 방식
- `ViewModel` 사용 방식
- `Activity` 재생성을 막고 수동으로 처리하는 방식
- `rememberSaveable` 을 사용하는 방식

`ViewModel`의 데이터 저장 방식을 알기위해서는 `ViewModelStore` 을 알아야합니다.

`ViewModelStore` 는 `ViewModel` 인스턴스를 저장하고 관리하는 역할을 하는 객체로 
기본적으로 `ViewModelProvider` 가 새로운 `ViewModel` 을 생성하거나 기존 `ViewModel` 을 찾는데 사용됩니다.

구성 변경이 일어나서 재구성이 일어나더라도 `ViewModelStore` 는 유지되기 떄문에,
새로 생성된 `Activity` 가 기존 `ViewModelStore` 를 참조해 기존 `ViewModel` 을 다시 사용합니다.

Q) AndroidManifest 파일에서 android:configChanges 속성은 Activity
생명주기와 동작에 어떤 영향을 미치며, Activity 재시작에 의존하는 것이 아니라
onConfigurationChanged() 메서드를 사용해야 하는 시나리오의 예시를 들어주세요.

간단한 예시로는 화면 회전시에 매번 Activity 를 재시작해서 초기화 때문에 느려지는것,
혹은 메모리 사용이 부담될 때, 상태 저장/복구에 부담을 느낄 때 등이 있습니다.<br/>
다만, 대부분의 사용에서 ViewModel 이나 내부 DB 를 통해 처리하는 것이 구성변경에 대한 처리 의도에 더 올바르게 보입니다. 