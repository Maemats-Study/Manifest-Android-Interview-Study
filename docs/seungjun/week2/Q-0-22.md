# Q) 22. 런타임 권한(runtime permissions)을 어떻게 처리하나요?
안드로이드 6.0 (API 레벨 23) 부터 앱 설치시 런타임에 위험 권한(dangerous permissions) 를
명시적으로 요청해야합니다. 사용자가 필요할 때만 권한을 부여하도록 허용하여 사용자 개인 정보 보호를 강화합니다.

###  1. Manifest에 권한 선언
가장 먼저, 앱이 사용하려는 모든 권한은 `AndroidManifest.xml` 파일에
`<uses-permission>` 태그로 반드시 선언해야 합니다.

```xml
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
```

### 2. 현재 권한 상태 확인
기능을 실행하기 전에 `ContextCompat.checkSelfPermission()`을 사용하여 사용자에게
이미 해당 권한이 부여되었는지 확인합니다.

권한이 이미 있다면 (PERMISSION_GRANTED): 추가 요청 없이 기능을 바로 실행합니다.

권한이 없다면: 다음 단계로 넘어가 권한을 요청할 준비를 합니다.

### 3. 권한 요청 사유(Rationale) 설명
사용자가 이전에 권한 요청을 한 번 이상 거부한 경우,
다시 요청하기 전에 왜 이 권한이 필요한지 친절하게 설명해주는 것이 좋습니다.
`ActivityCompat.shouldShowRequestPermissionRationale()` 메소드가 `true` 를 반환하면 이 경우에
해당합니다. AlertDialog 등을 사용하여 사용자에게 권한의 필요성을 설명하면 권한을 획득할 가능성이 높아집니다.

### 4. 권한 요청 및 결과 처리
네, 안드로이드 런타임 권한의 전체 처리 과정과 핵심 내용을 정리해 드리겠습니다.

권한을 요청할 때는 **ActivityResultLauncher** API 를 사용하는 것이 권장됩니다.
`registerForActivityResult`를 통해 런처를 등록하고, `launch()` 메소드로 시스템 권한 요청 대화상자를 띄웁니다.

사용자가 대화상자에서 **'허용'** 또는 **'거부'** 를 선택하면, 결과가 콜백으로 전달됩니다.

isGranted가 true (허용): 권한이 부여되었으므로 기능을 마저 실행합니다.<br/>
isGranted가 false (거부): 권한이 거부되었으므로, 해당 기능을 사용할 수 없음을 사용자에게 알리는 등 예외 처리를 합니다.

### 3. 특수한 경우 처리
사용자가 권한을 거부하면서 **'다시 묻지 않음'** 을 선택하면, 앱은 더 이상 권한 요청 대화상자를 띄울 수 없게 됩니다.
이 상태는 `checkSelfPermission()`이 여전히 거부 상태이면서 `shouldShowRequestPermissionRationale()`이 false를 반환하는 것으로 확인할 수 있습니다.

이때는 앱이 할 수 있는 유일한 조치는 사용자에게 기능이 제한됨을 알리고,
직접 시스템 설정 화면으로 이동하여 권한을 켜도록 안내하는 것입니다.

### 특수 권한
위치 권한: 포그라운드(앱 사용 중)와 백그라운드(앱이 꺼진 후에도) 권한이 분리되어 있습니다.
백그라운드 위치 권한을 얻으려면 반드시 포그라운드 권한을 먼저 요청하고 허락받아야 합니다.

일회성 권한 (Android 11+): 위치, 카메라, 마이크 권한에 대해 사용자는 '이번만 허용'을 선택할 수 있습니다.
이 경우 권한은 앱이 사용되는 동안에만 유효하며, 앱이 종료되면 권한은 자동으로 철회됩니다.

### 실전 질문
Q) 안드로이드의 런타임 권한 시스템은 사용자 개인 정보를 어떻게 보호하며,
민감한 권한을 요청하기 전에 앱은 어떤 시나리오를 고려해야 하나요?

민감한 권한을 요청하기 위해서 권한 요청 사유등을 제공하여 권한을 획득할 가능성을 높이고,
권한을 획득하지 못할 경우에 대한 처리를 잘해주어야합니다.