# Q) 0. Jetpack Compose의 동작 구조는 어떻게 이루어져 있나요?

선언적 접근 방식을 사용하여 네이티브 안드로이드 애플리케이션을 구축하기 위한 UI 툴킷

**Compose Compiler**, **Compose Runtime**, **Compose UI** 총 3가지 계층으로 이루어져 있음.

### Compose Compiler

Compose Compiler 는 Kotlin 으로 작성된 선언형 UI 코드를 Jetpack Compose 가 실행할 수 있는 최적화된 코드로 변환하는 역할*(코틀린 컴파일러로 구현됌)*

**주요 하는일**

- `@Compose` 함수 처리
- UI 업데이트 및 recomposition 로직 생성

> 어노테이션 처리 도구 종류
>
> - KAPT<br/>
      Java 기반(APT) 어노테이션 프로세서를 Kotlin에서 쓰기 위한 호환 도구<br/>
      Kotlin 코드를 Java stubs(중간 Java 코드)로 변환해 처리 → 느리고 Gradle 빌드 시간 증가<br/>
      구 기술 → 최신 프로젝트에서는 점점 사용 줄어드는 추세<br/>
> - KSP<br/>
    Kotlin 전용 어노테이션 처리기<br/>
    중간 Java 변환 없이 Kotlin AST(Symbol)를 직접 사용 → 빠르고 효율적, 빌드 시간 크게 단축<br/>
    Jetpack 라이브러리 대부분 KSP 지원 중
> - Compose Compiler 플러그인<br/>
    Compose의 `@Composable` 코드를 실제 동작 가능한 코드로 변환하는 전용 컴파일러 플러그인APT/KSP처럼 “어노테이션 프로세싱” 개념이라기보다<br/>
    컴파일러 레벨에서 Composable 트리를 재작성(Transform)하는 기능<br/>
     `remember`, `recomposition`, `slot table` 같은 Compose 내부 매커니즘을 자동으로 코드 생성

### Compose Runtime

Compose Runtime 은 recomposition 및 상태 관리 지원하는 데 필요한 핵심 기능 제공

변경 가능한 상태를 처리하고, 스냅샷을 관리하며, 애플리케이션 상태가 변경 될 때마다 UI 업데이트를 트리거

**동작 방식**

갭버퍼 자료구조를 참고한 방식으로 슬롯 테이블을 사용해 컴포지션 상태를 메모이징 하는 방식으로 작동

**주요 하는일**

- SideEffect 관리
- remember 를 통한 상태 보존
- 상태 변경 시 recmposition 트리거
- CompositionLoacl 에서의 데이터 저장
- Compose 레이아웃 노드 구축

> **용어**
갭버퍼: 텍스트 편집기에서 문자의 동적 시퀀스를 효율적으로 관리하는 데 사용되는 자료구조,<br/>
필요할 때만 요소를 이동하여 빠른 삽입 및 삭제를 허용하는 갭이 있는 연속적인 메모리 블록을 유지해 빈번한 수정 오버헤드를 줄임<br/><br/>
슬롯 테이블: 컴포지션 단계 중 UI 컴포넌트의 상태를 저장하고 관리하기 위해 Jetpack Compose 에서 사용되는 자료구조, 상태 변경에 영향을 받는 요소만 업데이트
>

**++ 추가**

기존의 갭 버퍼 방식에서 링크 테이블 자료 구조로 마이그레이션 하고 있다고 한다.

링크테이블이란, 연결된 노드를 사용해 데이터를 구성하여, 효율적인 삽입, 삭제 및 재배열이 가능하다.

일종의 연결 리스트를 접목한것과 비슷해 보인다.

### Compose UI

커스텀 UI 컴포넌트 구축을 위한 상위 호환의 API 포함

Kotlin Multiplatform 지원을 통해 JetBrains 는 Compose Multiplaform 지원을 하여 일관된 UI 를 만들 수 있도록 개발자 생태계를 만들고 있음.

### 실전 질문

Q) Compose Compiler의 역할은 무엇이고, KAPT 또는 KSP와 같은 전통적인 어노테이션 프로세서와 어떻게 다른가요?

- `@Composable`을 위한 **전용 컴파일러 플러그인**
- hidden parameter(Composer) 삽입, recomposition 최적화 코드 자동 생성
- 기존 소스코드를 **변환(transform)** 하며 새로운 파일을 만들지 않음
- KAPT/KSP는 일반적인 **어노테이션 기반 코드 생성** 도구로 목적과 구조가 완전히 다름

Q) Compose Runtime은 recomposition과 상태를 어떻게 관리하며, 내부적으로 어떤 자료 구조를 사용하나요?

- UI 상태를 Slot Table이라는 자료구조에 저장
- 상태가 변경되면 Snapshot 시스템이 이를 감지
- Slot Table을 기반으로 변경된 위치만 부분 재구성(recomposition)
- 효율적인 UI 업데이트가 가능해 지는 핵심 구조