# Q 38) View시스템의 무효화란 무엇인가요?

---

무효화(Invalidation)는 View를 다시 그려야 함을 표시하는 프로세스를 의미합니다. 이는 변경 사항이 발생할 때 UI를 업데이트하기 위해 안드로이드 View 시스템에서 사용되는 기본 메커니즘입니다. View가무효화되면 시스템은 다음 드로잉 주기 동안 화면의 해당 부분을 새로 고쳐야 함을 인지하고 새롭게 그립니다

무효화 작동 방식
View에서 invalidate() 또는 postInvalidate()와 같은 메서드를 호출하면 무효화 프로세스가 트리거됩니다. 시스템은 View를 “더티(dirty)“로 플래그 지정하며, 이는 다시 그려야 함을 의미합니다. 다음 프레임 동안 시스템은 무효화된 View를 드로잉 패스에 포함시켜 시각적 표현을 업데이트합니다.
예를 들어, 위치, 크기 또는 모양과 같은 View의 속성이 변경되면 무효화 프로세스를 통해 사용자가 업데이트된 상태를 볼 수 있도록 보장합니다.

> 무효화(invalidation) 프로세스가 필요한 이유는 View에 변화가 필요할 때마다, 새롭게 View를 다시 랜더링
하는 것이 아니라, 개발자나 시스템에 의해 시기적절한 순간에 업데이트되도록 제한함으로써 더 나은 성능을 만들 수 있습니다. 그렇지않고 자동적으로 View가 업데이트된다면, 무분별한 렌더링으로 앱의 전반적인 성능이 크게 떨어질 수 있습니다. Jetpack Compose에서는 이러한 무효화 프로세스가 없고 상태에 따라 자동적으로 UI가 업데이트되기 때문에 성능에 더 각별한 주의가 필요합니다.
> 

1. invalidate(): 이 메서드는 단일의 View를 무효화하는 데 사용됩니
다. View를 더티로 표시하여 시스템이 다음 레이아웃 패스 중에다시 그리도록 신호를 보냅니다. View를 즉시 다시 그리는 것이 아니라 다음 프레임을 위해 예약합니다.

2.  invalidate(Rect dirty): 이는 invalidate()의 오버로드된 버전으로, 다시 그려야 하는 View 내의 특정 직사각형 영역을 지정할 수 있습니다. 더 작은 부분으로 다시 그리기를 제한하여 성능을 최적화합니다.

3.  postInvalidate(): 이 메서드는 UI 스레드가 아닌 스레드에서 View를 무효화하는 데 사용됩니다. 무효화 요청을 메인 스레드에 게시하여 스레드 안전성을 보장합니다.

**invalidate()를 사용하여 커스텀 View 업데이트하기**

아래는 상태가 변경될 때 UI를 다시 그리기 위해 invalidate() 메서드가 사용되는 커스텀 View의 예시입니다

안드로이드 뷰 시스템에서 무효화(invalidate)는 뷰의 시각적인 내용이 변경되어 다시 그려져야 함을 시스템에 알리는 과정입니다. invalidate()를 호출하면, 시스템은 다음 드로잉 사이클에서 해당 뷰의 onDraw() 메서드를 호출하여 화면을 갱신합니다.

**invalidate()와 postInvalidate()**

뷰 무효화를 위해 주로 사용되는 두 가지 메서드에는 invalidate()와 postInvalidate()가 있으며, 호출하는 스레드에 따라 차이가 있습니다.

| **특징** | **`invalidate()`** | **`postInvalidate()`** |
| --- | --- | --- |
| **호출 스레드** | **UI(메인) 스레드**에서만 호출해야 합니다. | **백그라운드(비 UI) 스레드**에서 호출할 수 있습니다. |
| **작동 방식** | 즉시 무효화 플래그를 설정하여, 다음 드로잉 사이클에 `onDraw()`를 호출합니다. | 메시지 큐에 무효화 요청을 보냅니다. UI 스레드가 이벤트 루프의 다음 주기에서 이 요청을 처리하게 됩니다. |
| **사용 사례** | UI 스레드에서 뷰의 상태가 변경되었을 때 즉시 화면 갱신이 필요할 때 사용합니다 (예: 터치 이벤트에 따른 뷰 변경). | 백그라운드 스레드에서 데이터를 가져와 뷰를 업데이트해야 할 때 사용합니다 (예: 네트워크 통신 후 이미지 변경). |

**무효화 과정의 흐름**

1. **개발자 호출**: 뷰의 상태가 변경되면 개발자는 invalidate() 또는 postInvalidate()를 호출합니다.
2. **무효화 요청 전파**: 뷰에서 invalidate()가 호출되면, 무효화 요청은 뷰 계층 구조를 따라 상위 부모 뷰(ViewGroup)로 전달됩니다.
3. **더티 영역 계산**: 안드로이드 시스템은 무효화된 뷰가 포함된 화면 영역(더티 영역)을 계산합니다.
4. **그리기 재개**: 다음 프레임이 그려질 때, 안드로이드 시스템은 onDraw() 메서드를 호출하여 더티 영역을 다시 그립니다.
5. **뷰 갱신**: onDraw()에서 뷰의 새로운 내용이 화면에 반영됩니다.

**무효화와 관련된 추가 메서드**

- **requestLayout()**: 뷰의 크기나 위치가 변경될 때 호출하는 메서드입니다. invalidate()가 단순히 다시 그리는 것과 달리, requestLayout()은 뷰 계층 구조 전체의 크기(onMeasure)와 배치(onLayout)를 다시 계산하도록 요청합니다.
- **postInvalidateOnAnimation()**: postInvalidate()와 유사하게 백그라운드 스레드에서 사용할 수 있지만, 다음 애니메이션 프레임에 맞춰 무효화 요청을 스케줄링합니다. 이는 지속적인 애니메이션 효과를 구현할 때 더 효율적일 수 있습니다.