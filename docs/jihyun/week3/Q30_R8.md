# R8 최적화란?

<aside>

- R8은 안드로이드 빌드 프로세스에서 APK 또는 AAB의 크기를 줄이고 런타임 성능을 향상시키기 위해 사용되는 코드 축소 및 최적화 도구
- 안드로이드 빌드 시스템에 통합되어 이전의 ProGuard 도구를 대체
- 코드 축소, 최적화, 난독화 및 리소스 관리를 위한 향상된 기능을 제공
</aside>

## R8 작동 방식

R8은 빌드 단계 중에 애플리케이션 코드를 수정하여 아래 목적들을 달성

- 코드 축소(Shrinking)
    - 애플리케이션 코드베이스에서 사용되지 않는 클래스, 메서드, 필드 및 속성을 제거
    - 최종적인 APk 또는 AAB 크기를 줄임
- 최적화(Optimization)
    - 런타임 성능을 향상시키기 위해 코드를 단순화하고 재구성
    - 메서드 inlining, 중복 코드 제거, 동일한 코드 블록 병합 등이 포함됨
- 난독화(Obfuscation)
    - 클래스, 메서드 및 필드의 이름을 변경하여 원래 이름을 모호하게 만들어 리버스 엔지니어링을 더 어렵게 만듦
- 리소스 최적화
    - 사용되지 않는 리소스(레이아웃, Drawable, 문자열)를 제거하여 앱 사이즈를 더욱 최소화

## R8 최적화의 주요 특징

- Dead Code Removal
    - 코드베이스를 분석하여 앱에서 도달할 수 없거나 사용되지 않는 코드를 식별하고 제거
- Inlining
    - 짧은 메서드나 함수를 호출자쪽에 직접 인라인하여 메서드 호출 오버헤드를 줄이고 런타임 성능을 향상
- Class Merging
    - 유사한 클래스나 인터페이스를 하나로 결합하여 메모리 공간을 줄이고 효율성 향상
- Unreachable Code Elimination
    - 실행되지 않는 코드 경로를 완전히 제거
- Obfuscation
    - 코드의 의미 있는 이름을 더 짧고 덜 설명적인 이름으로 대체
    - 앱 크기를 줄이고 리버스 엔지니어링을 더 어렵게 함

## R8 구성

- R8은 앱 빌드 구성을 위해 ProGuard 규칙을 동일하게 사용
- 코드의 어떤 부분을 추속, 난독화 또는 최적화에서 제외할지 지정 가능
- 사용 사례
    - 리플렉션을 위한 코드 보존
        - 리플렉션을 통해 접근하는 클래스나 메서드는 런타임에 해당 패키지 이름을 알아야하기 때문에  ProGuard 규칙에 명시적으로 유지(keep)하여 난독화 하지 않도록 함
    - 서드파티 라이브러리 제외
        - 일부 라이브러리는 내부적으로 리플렉션을 사용할 수도 있고, 정상적인 기능 동작을 위해 특정 규칙이 필요할 수 있음
- 난독화 하지 않고 보존하기 위한 ProGuard 규칙
    - `‑keep class com.example.myapp.MyClass { *; }`

## R8의 장점

- 긴밀한 통합: 안드로이드 빌드 시스템에 내장 → 일반적인 ProGuard 규칙 외에 추가 설정이 필요하지 않음
- 향상된 효율성: 축소, 최적화 및 난독화를 단일 패스로 결합 → ProGuard보다 빠르고 효율적
- 앱 크기 감소: 사용되지 않는 코드와 리소스 제거 → 최종 APk 또는 AAB 크기를 줄임
- 향상된 보안: 난독화는 해커 및 크래커가 앱을 리버스 엔지니어링하기 어렵게 만들어 보안 강화

## R8의 한계

- 과도한 축소 위험: 제대로 구성하지 않으면 R8이 간접적으로 참조되는 코드나 리소스를 제거하여 런타임 오류를 유발할 수 있음
- 복잡한 구성: 복잡한 프로젝트, 특히 리플렉션이나 동적 클래스 로딩을 사용하는 프로젝트의 경우 ProGuard 규칙 작성이 복잡하고 까다로울 수 있음
- 디버깅 어려움: 난독화는 스택 트레이스에 난독화된 이름이 로깅되기 때문에 디버깅을 더 어렵게 만들 수 있음