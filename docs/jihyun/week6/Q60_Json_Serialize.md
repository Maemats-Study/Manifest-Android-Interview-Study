# Json 형식을 객체로 어떻게 직렬화하나요?

- 최신 안드로이드 앱은 원격 서버(REST API, GraphQL 엔드포인트, Firebase 등)와 자주 상호 작용 → JSON을 객체로 직렬화하는 것은 안드로이드 개발에서 일반적
- 일반적으로 백엔드에서 JSON 형식으로 데이터를 자주 교환 → 가볍고 가독성이 좋으며 플랫폼으로부터 독립적
- 지속적으로 변동성이 있는 사용자 데이터, 환경 설정 또는 컨텐츠(뉴스 기사, 메시지 등)를 리모트 서버(백엔드)에서 가져오기 위해 앱은 Kotlin 객체를 JSON으로 직렬화하여 데이터를 백엔드로 보내 필요한 정보 요청, 서버의 JSON 응답을 받으면 다시 객체로 역직렬화

## 직렬화(Serialization)와 역직렬화(Deserialization)란?

- 직렬화(Serialization)
    - 객체나 데이터 구조를 나중에 쉽게 저장, 전송 또는 재구성할 수 있는 형식으로 변환하는 프로세스
    - 안드로이드와 백엔드 통신에서는 종종 객체를 JSON 문자열이나 유사한 구조화된 형식으로 변환하는 것을 의미
- 역직렬화(Deserialization)
    - 직렬화된 데이터(JSON 문자열 등)를 가져와 애플리케이션에서 작업할 수 있는 메모리 내 객체로 다시 재구성하는 역 프로세스

## 수동 직렬화 및 역직렬화

- 외부의 솔루션을 사용하지 않고도 직접 수동적으로 문자열 조작 및 파싱 기술을 통해 객체를 JSON 문자열로 변환하고, 그 반대로 변환하여 수동으로 JSON을 직렬화하고 역직렬화할 수도 있음
- 수동 직렬화는 객체의 속성을 JSON 문자열로 바꾸는 것을 동반
- 수동 역직렬화는 JSON 문자열을 파싱하고 값을 추출하여 객체를 재구성하는 것을 동반
- 이 방법은 유지 관리, 안정성 및 확장성 문제로 인해 프로덕션 앱에는 권장되는 방법은 아니지만, 학습 목적이나 의존성을 최소화해야하는 가벼운 경우에는 유용할 수 있음
- 수동적으로 직/역직렬화를 하는 대신, kotlinx.serialization, Moshi, Gson과 같은 라이브러리를 통해 해당 프로세스를 훨씬 더 효과적으로 직렬화/역직렬화 할 수 있음

## kotlinx.serialization

- Kotlin과 직접적으로 통합되어 Kotlin의 언어적 기능을 활용하도록 설계됨
- 어노테이션을 사용하여 직렬화 동작을 정의하고 JSON 뿐만 아니라 ProtoBuf와 같은 다른 형식과도 원활하게 작동
- Kotlin 컴파일러 플러그인을 사용하여 Kotlin 객체를 JSON 문자열로 변환(직렬화)하고 JSON 문자열을 다시 Kotlin 객체로 파싱(역직렬화)하는 타입 안정성을 보장
- 내부적으로 리플렉션을 사용하지 않는 메커니즘을 제공 → 최신 안드로이드 및 Kotlin 개발에서 가장 선호되는 방법 중 하나
- 내부적으로 Kotlin은 Moshi의 리플렉션 모드 및 Gson과 달리 무거운 런타임 리플렉션 없이 효율적인 직렬화를 수행하기 위해 컴파일러가 생성하는 코드에 의존코등

## Moshi

- 타입 안정성과 Kotlin 지원을 강조하는 최신 JSON 라이브러리
- Gson과 달리 Moshi는 Kotlin의 null 가능성 및 기본 매개변수를 기본적으로 지원
- 이로 인해 Moshi는 Kotlin을 사용하는 프로젝트에 아주 적합
- JSON 직렬화 및 역직렬화를 처리하는 두 가지 주요 접근 방식: 리플렉션에 기반한 동작 방식 & 컴파일 타임에 코드를 생성하는 방식
    - 리플렉션 기반
        - Java 리플렉션을 사용하여 런타임에 동적으로 JSON 어댑터를 생성 → 추가 설정 없이 사용법이 간단
        - 런타임 오버헤드 발생
    - 코드 생성 기반
        - 어노테이션 프로세스 기법을 통해 컴파일 타임에 JSON 어댑터를 생성
        - 더 빠른 런타임 성능과 컴파일 타임 오류 검사를 제공

## Gson

- Google에서 개발한 Gson은 널리 사용되는 JSON 라이브러리
- Java 객체를 JSON으로 직렬화하고 JSON을 다시 Java 객체로 역직렬화할 수 있음
- Gson보다 kotlinx.serialization 또는 Moshi를 선택해야 하는 이유
    - 더 나은 Kotlin 지원
        - Gson은 Java용으로 설계됨
        - Kotlin 기능을 kotlinx.serialization 또는 Moshi 만큼 자연스럽게 처리하지 못함
    - 성능 및 효율성
        - kotlinx.serialization 및 Moshi는 런타임에 리플렉션에 크게 의존하는 Gson보다 빠르고 메모리 효율적
    - 멀티플랫폼 호환성
        - kotlinx.serialization은 Kotlin Multiplatform(KMP)을 완벽하게 지원
        - Moshi/Gson은 JVM 위에서 동작하도록 설계되어 있어 크로스 플랫폼 앱에는 적합하지 않음
    - 컴파일 타임 안전성
        - 컴파일 타임에 필요한 코드를 생성하는 kotlinx.serialziation 및 Moshi는 컴파일 타임에 대부분의 오류를 감지하여 런타임 크래시를 줄임
        - Gson은 종종 런타임 오류로 크래시 발생